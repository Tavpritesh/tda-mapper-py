<!DOCTYPE html>
<meta charset="utf-8">
<style>

.link {
  stroke: #000;
}

.node {
  fill: #ccc;
  stroke: #000;
}

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="./graph.json"></script>
<script>

var width = 960,
    height = 500;

var minMaxSize = graph.nodes.map(function (node) {
    return node.size;
}).reduce(function (a,size) { 
    if (size >= a[1]) a[1] = size;
    if (size <= a[0]) a[0] = size;
    return a
},[+Infinity,-Infinity]);

var minMaxIndex = graph.nodes.map(function (node) {
    return node.name[0];
}).reduce(function (a,k) { 
    if (k >= a[1]) a[1] = k;
    if (k <= a[0]) a[0] = k;
    return a
},[+Infinity,-Infinity]);


var linear = function(dx, dy, f) {
  return function (x) {
        var y0 = dy[0], 
        y1 = dy[1], 
        x0 = dx[0], 
        x1 = dx[1],
        val = (x-x0)*(y1-y0)/(x1 - x0) + y0;
   return f == undefined ? val : f(val);

  };
};

var xPosition = linear(minMaxIndex, [100, width - 50]);

var color = linear(minMaxIndex,[0,255], function (val) {
    val = Math.floor(val);
    return "rgb("+val+","+(255-val)+","+0+")";
});

var size = linear(minMaxSize,[3,15]);

var nameToPosition = function (name) {
  var coverIndex = name[0];
  var clusterIndex = name[1];
  return [xPosition(coverIndex), clusterIndex*50 + 100]
};



graph.nodes.forEach(function (node) {
  var position = nameToPosition(node.name);
  node.x = position[0];
  node.y = position[1];
});

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var force = d3.layout.force()
    .nodes(graph.nodes)
    .links(graph.links)
    .size([width, height])
    .linkStrength(0.0)
    .friction(0.1)
    .charge(-100)
    .gravity(0.0)
    .theta(0.0)
    .alpha(0.0)
    .start();

var link = svg.selectAll(".link")
    .data(graph.links)
    .enter().append("line")
    .attr("class", "link")
    .style("stroke-width", function(d) { return d.value; });

var node = svg.selectAll(".node")
    .data(graph.nodes)
    .enter().append("circle")
    .attr("class", "node")
    .attr("r", function (d) { return size(d.size); })
    .style("fill", function(d) { return color(d.name[0]); });


force.on("tick", function(e) {

    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node.attr("cx", function(d) { return d.x; })
    node.attr("cy", function(d) { return d.y; })

});


</script>
</body>


